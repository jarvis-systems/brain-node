# Invoked via: /mem:cleanup

description = "Cleanup old memories or delete by ID"
prompt = """
<command>
<meta>
<id>mem:cleanup</id>
<description>Cleanup old memories or delete by ID</description>
</meta>
<purpose>Memory cleanup utility. Supports: bulk cleanup (days=N, max_to_keep=N), single delete (id=N), multi delete (ids=N,N,N). All operations require explicit confirmation.</purpose>
<purpose>Memory cleanup utility for bulk deletion by age/count or specific ID deletion. Requires confirmation for destructive operations.</purpose>
<guidelines>
<guideline id="role">
<text>Memory cleanup utility that handles bulk deletion by age/count or specific ID deletion. All destructive operations require explicit confirmation.</text>
</guideline>
<guideline id="workflow-step1">
<text>STEP 1 - Parse $ARGUMENTS for Operation Type</text>
<example>
<phase name="format-1">/mem:cleanup → preview default cleanup (30 days, keep 1000)</phase>
<phase name="format-2">/mem:cleanup days=60 → cleanup older than 60 days</phase>
<phase name="format-3">/mem:cleanup max_to_keep=500 → keep only 500 most recent</phase>
<phase name="format-4">/mem:cleanup id=15 → delete specific memory</phase>
<phase name="format-5">/mem:cleanup ids=15,16,17 → delete multiple specific</phase>
<phase name="detect">STORE-AS($MODE = 'bulk|single|multi')</phase>
</example>
</guideline>
<guideline id="workflow-step2">
<text>STEP 2 - Handle Single ID Delete</text>
<example>
<phase name="check">IF(STORE-GET($MODE) === "single") → THEN → [Extract ID from $ARGUMENTS → mcp__vector-memory__get_by_memory_id('{memory_id: {id}}') → STORE-AS($TARGET = 'memory to delete') → Display: "--- Memory to Delete ---" → Display: "ID: {id}" → Display: "Category: {category}" → Display: "Content: {content_preview}" → Display: "Tags: {tags}" → Display: "" → Prompt: "DELETE this memory? This cannot be undone. (yes/no)"] → END-IF</phase>
</example>
</guideline>
<guideline id="workflow-step3">
<text>STEP 3 - Handle Multiple IDs Delete</text>
<example>
<phase name="check">IF(STORE-GET($MODE) === "multi") → THEN → [Extract IDs array from $ARGUMENTS → ForEach ID: fetch memory preview → Display: "--- Memories to Delete ({count}) ---" → ForEach: "#{id} [{category}] {preview}" → Display: "" → Prompt: "DELETE all {count} memories? This cannot be undone. (yes/no)"] → END-IF</phase>
</example>
</guideline>
<guideline id="workflow-step4">
<text>STEP 4 - Bulk Cleanup Preview</text>
<example>
<phase name="check">IF(STORE-GET($MODE) === "bulk") → THEN → [Parse: days_old (default 30), max_to_keep (default 1000) → mcp__vector-memory__get_memory_stats('{}') → Calculate: how many would be deleted → Display: "--- Cleanup Preview ---" → Display: "Current total: {total} memories" → Display: "Settings: days_old={days}, max_to_keep={max}" → Display: "Would delete: ~{estimate} memories" → Display: "Would keep: ~{remaining} memories" → Display: "" → Prompt: "Proceed with cleanup? (yes/no)"] → END-IF</phase>
</example>
</guideline>
<guideline id="workflow-step5">
<text>STEP 5 - Execute After Confirmation</text>
<example>
<phase name="validate">VALIDATE(User response is YES, DELETE, or CONFIRM) → FAILS → [Abort: "Cleanup cancelled."] → END-VALIDATE</phase>
<phase name="execute-single">IF(STORE-GET($MODE) === "single") → THEN → [mcp__vector-memory__delete_by_memory_id('{memory_id: {id}}') → Display: "Memory #{id} deleted successfully."] → END-IF</phase>
<phase name="execute-multi">IF(STORE-GET($MODE) === "multi") → THEN → [ForEach ID: mcp__vector-memory__delete_by_memory_id('{memory_id: {id}}') → Display: "Deleted {count} memories successfully."] → END-IF</phase>
<phase name="execute-bulk">IF(STORE-GET($MODE) === "bulk") → THEN → [mcp__vector-memory__clear_old_memories('{days_old: {days}, max_to_keep: {max}}') → Display: "Cleanup completed. Removed {count} old memories."] → END-IF</phase>
</example>
</guideline>
<guideline id="output-format">
<text>Cleanup display format</text>
<example key="header-bulk">--- Cleanup Preview ---</example>
<example key="header-single">--- Memory to Delete ---</example>
<example key="total">Current total: 37 memories</example>
<example key="estimate">Would delete: ~12 memories</example>
<example key="confirm-single">DELETE this memory? This cannot be undone. (yes/no)</example>
<example key="confirm-bulk">Proceed with cleanup? (yes/no)</example>
<example key="cancelled">Cleanup cancelled.</example>
<example key="success-single">Memory #15 deleted successfully.</example>
<example key="success-bulk">Cleanup completed. Removed 12 old memories.</example>
</guideline>
<guideline id="usage-examples">
<text>Command usage patterns</text>
<example key="preview">/mem:cleanup → preview default cleanup</example>
<example key="days">/mem:cleanup days=60 → older than 60 days</example>
<example key="limit">/mem:cleanup max_to_keep=500 → limit to 500</example>
<example key="single">/mem:cleanup id=15 → delete specific memory</example>
<example key="multi">/mem:cleanup ids=15,16,17 → delete multiple</example>
</guideline>
</guidelines>
<iron_rules>
<rule id="mandatory-confirmation" severity="critical">
<text>ALL delete operations MUST require explicit user confirmation</text>
<why>Deletion is permanent and cannot be undone</why>
<on_violation>Show preview, ask for YES/DELETE confirmation, never auto-delete</on_violation>
</rule>
<rule id="show-preview" severity="high">
<text>MUST show what will be deleted before confirmation</text>
<why>User must understand impact before confirming</why>
<on_violation>Display count, preview content, then ask confirmation</on_violation>
</rule>
</iron_rules>
</command>
"""