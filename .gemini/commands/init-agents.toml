# Invoked via: /init-agents

description = "Incremental Agent Gap Analyzer - Auto-generates missing domain agents (project)"
prompt = """
<command>
<meta>
<id>init-agents</id>
<description>Incremental Agent Gap Analyzer - Auto-generates missing domain agents (project)</description>
</meta>
<purpose>Auto-analyze
GEMINI.md
and existing agents → identify gaps → generate missing agents via
brain make:master
→ safe for repeated runs. Supports optional $ARGUMENTS for targeted search.</purpose>
<purpose>The InitAgents command initializes the project with agents based on industry best practices.</purpose>
<iron_rules>
<rule id="mandatory-agentmaster-delegation" severity="critical">
<text>Brain MUST delegate ALL agent generation to AgentMaster. FORBIDDEN: Brain creating agents directly.</text>
<why>Separation of orchestration (Brain) and execution (AgentMaster). Brain is NOT an executor.</why>
<on_violation>ABORT. Delegate to AgentMaster immediately. Brain orchestrates, never executes.</on_violation>
</rule>
<rule id="project-agents-only" severity="critical">
<text>ONLY create PROJECT-SPECIFIC agents using Master variation FORBIDDEN: Creating or modifying SYSTEM agents (AgentMaster, PromptMaster, CommitMaster, etc.) FORBIDDEN: Modifying agents from vendor/jarvis-brain/core/src/ System agents use SystemMaster variation and are OFF LIMITS</text>
<why>System agents are pre-configured via SystemMaster variation. Project agents use Master variation.</why>
<on_violation>Skip system agent. Only create project-specific agents.</on_violation>
</rule>
<rule id="preserve-system-agents" severity="critical">
<text>System agents (ending with Master) are managed by SystemMaster variation Examples: AgentMaster, PromptMaster, CommitMaster, WebResearchMaster, ExploreMaster, DocumentationMaster, VectorMaster, ScriptMaster These agents are specialized for Brain orchestration - NEVER regenerate or modify them</text>
<why>System agents have carefully tuned configurations for Brain ecosystem</why>
<on_violation>ABORT modification. System agents are immutable.</on_violation>
</rule>
<rule id="parallel-agentmaster-execution" severity="critical">
<text>Run up to 5 AgentMaster instances in PARALLEL. Each AgentMaster can generate 1-3 agents per batch.</text>
<why>Maximizes throughput. Sequential generation wastes time. Parallel = 5x faster.</why>
<on_violation>Batch agents into groups of 3, delegate to 5 AgentMasters concurrently.</on_violation>
</rule>
<rule id="no-interactive-questions" severity="critical">
<text>NO interactive questions. Fully automated gap analysis and generation.</text>
<why>Automated workflow requires zero user prompts</why>
<on_violation>Execute fully automated</on_violation>
</rule>
<rule id="brain-make-master-only" severity="critical">
<text>AgentMaster MUST use Bash('brain make:master') for creation - NOT Write() or Edit()</text>
<why>Ensures proper PHP archetype structure and compilation compatibility</why>
<on_violation>Reject manually created agents</on_violation>
</rule>
<rule id="no-regeneration" severity="critical">
<text>Skip existing agents. Idempotent operation.</text>
<why>Safe for repeated execution</why>
<on_violation>Skip and continue</on_violation>
</rule>
<rule id="delegates-web-research" severity="high">
<text>Delegate web research to WebResearchMaster. Brain NEVER executes WebSearch.</text>
<why>Maintains delegation hierarchy</why>
<on_violation>Delegate to WebResearchMaster</on_violation>
</rule>
</iron_rules>
<guidelines>
<guideline id="phase0-arguments-processing">
GOAL(Process optional user arguments to narrow search scope and improve targeting)
## Examples
 - Parse $ARGUMENTS for specific domain/technology/agent hints
 - IF($ARGUMENTS provided) → THEN → [Extract: target_domain (e.g., "Laravel", "React", "API"), target_technology, specific_agents → STORE-AS($SEARCH_FILTER = '{domain: ..., tech: ..., agents: [...], keywords: [...]}') → Set search_mode = "targeted" → Log: "Targeted mode: focusing on {domain}/{tech}"] → END-IF
 - IF($ARGUMENTS empty) → THEN → [Set search_mode = "discovery" → Use full project analysis workflow → Log: "Discovery mode: full project analysis"] → END-IF
 - Store search mode for use in subsequent phases
</guideline>
<guideline id="phase1-temporal-context-and-web-cache">
GOAL(Get current date/year for temporal context AND check vector memory cache for recent patterns)
## Examples
 - Bash(date +"%Y-%m-%d") → [STORE-AS($CURRENT_DATE)] → END-Bash
 - Bash(date +"%Y") → [STORE-AS($CURRENT_YEAR)] → END-Bash
 - PARALLEL: Check vector memory cache while temporal context loads
 - mcp__vector-memory__search_memories('{query: "multi-agent architecture patterns", category: "learning", limit: 3}')
 - IF(cache_hit AND cache_age < 30 days) → THEN → [STORE-AS($CACHED_PATTERNS = 'Cached industry patterns from vector memory') → STORE-AS($CACHE_VALID = 'true') → STORE-AS($CACHE_AGE = '{days}') → Log: "Using cached patterns (age: {days} days)"] → END-IF
 - IF(no_cache OR cache_old) → THEN → [STORE-AS($CACHE_VALID = 'false') → Log: "Fresh web search required"] → END-IF
</guideline>
<guideline id="phase1.5-web-search-best-practices">

GOAL(Delegate industry best practices research to WebResearchMaster with cache awareness)
NOTE(Delegated to WebResearchMaster for industry research)

## Examples
 - IF(search_mode === "discovery") → THEN → [Task(mcp__brain__agent(web-research-master), 'INPUT(STORE-GET($CURRENT_YEAR) && STORE-GET($CACHED_PATTERNS) && STORE-GET($CACHE_VALID) && STORE-GET($CACHE_AGE))', 'TASK → [IF(cache_valid === true) → THEN → Use cached patterns, skip web search → END-IF → IF(cache_valid === false) → THEN → [ →   Research: multi-agent system architecture best practices {year} →   Research: AI agent orchestration patterns {year} →   Research: domain-driven agent design principles {year} →   Synthesize findings into unified patterns → ] → END-IF] → END-TASK', 'OUTPUT({architecture: [...], orchestration: [...], domain_design: [...], sources: [...], cache_used: true|false})', 'STORE-AS($INDUSTRY_PATTERNS)') → IF(fresh research performed) → Store results in vector memory → mcp__vector-memory__store_memory('{content: $INDUSTRY_PATTERNS, category: "learning", tags: ["agent-patterns", "best-practices", "{CURRENT_YEAR}"]}')] → END-IF
 - IF(search_mode === "targeted") → THEN → [Use $CACHED_PATTERNS from phase 1 if available → Log: "Targeted mode - using cached patterns, skipping general research"] → END-IF
</guideline>
<guideline id="phase2-inventory-agents">

GOAL(List all existing agents and separate SYSTEM agents from PROJECT agents)
NOTE(SYSTEM agents (use SystemMaster variation): AgentMaster, PromptMaster, CommitMaster, WebResearchMaster, ExploreMaster, DocumentationMaster, VectorMaster, ScriptMaster PROJECT agents (use Master variation): All other agents created for project-specific needs System agents are OFF LIMITS - only inventory, never modify or regenerate)

## Examples
 - Bash('brain list:masters') Parse output
 - STORE-AS($ALL_AGENTS = '[{id, name, description}, ...]')
 - Filter system agents (names ending with "Master" AND in system list)
 - STORE-AS($SYSTEM_AGENTS = '[AgentMaster, PromptMaster, CommitMaster, WebResearchMaster, ExploreMaster, DocumentationMaster, VectorMaster, ScriptMaster, ...]')
 - Filter project agents (all others)
 - STORE-AS($PROJECT_AGENTS = '[...project-specific agents...]')
 - Agents located in .brain/node/Agents/*.php
 - Count: system_agents = count($SYSTEM_AGENTS), project_agents = count($PROJECT_AGENTS)
 - Log: "System agents (protected): {system_count}, Project agents (manageable): {project_count}"
</guideline>
<guideline id="phase3-read-project-stack">
GOAL(Extract project technology stack with optional filtering based on $ARGUMENTS)
## Examples
 - Task(mcp__brain__agent(explore), 'TASK → [(IF(search_mode === "targeted") → THEN → [Priority 1: Focus exploration on $SEARCH_FILTER.domain and $SEARCH_FILTER.tech → Priority 2: Validate against project documentation (.docs/, CLAUDE.md) → Priority 3: Extract related technologies and dependencies] → END-IF + IF(search_mode === "discovery") → THEN → [Priority 1: Explore .docs/ directory if exists. Find all *.md files. → Priority 2: Extract: technologies, frameworks, services, domain requirements → Priority 3: Explore project files in ./ for tech stack (composer.json, package.json, etc.)] → END-IF + STORE-AS($PROJECT_STACK = \\'{technologies: [...], frameworks: [...], services: [...], domain_requirements: [...], primary_stack: "...", confidence: 0-1}\\'))] → END-TASK')
</guideline>
<guideline id="phase3.5-stack-specific-search">

GOAL(Delegate technology-specific research to WebResearchMaster based on discovered stack)
NOTE(Delegated to WebResearchMaster for technology-specific patterns)

## Examples
 - Extract primary technologies from $PROJECT_STACK (max 3 most important)
 - Task(mcp__brain__agent(web-research-master), 'INPUT(STORE-GET($PROJECT_STACK.technologies) && STORE-GET($CURRENT_YEAR) && STORE-GET($SEARCH_FILTER) && STORE-GET($SEARCH_MODE))', 'TASK → [Extract top 3 most important technologies from stack → IF(search_mode === "targeted") → THEN → Focus on $SEARCH_FILTER tech → END-IF → FOREACH(technology in top_3_technologies) → [ →   IF(technology is major framework/language) → THEN → [ →     Research: {technology} specialized agents best practices {year} →     Research: {technology} multi-agent architecture examples {year} →     Extract: common patterns, agent types, use cases →   ] → END-IF → ] → END-FOREACH → Synthesize per-technology patterns] → END-TASK', 'OUTPUT({tech_patterns: {Laravel: [...], React: [...]}, tech_examples: {...}})', 'STORE-AS($TECH_PATTERNS)')
 - Cache technology patterns in vector memory
 - mcp__vector-memory__store_memory('{content: $TECH_PATTERNS, category: "learning", tags: ["tech-patterns", $PROJECT_STACK.primary_stack, "{CURRENT_YEAR}"]}')
 - IF(search_mode === "targeted") → THEN → [Log: "Found {count} patterns for {$SEARCH_FILTER.tech}" → Boost relevance score for matching patterns] → END-IF
</guideline>
<guideline id="phase4-gap-analysis-enhanced">

GOAL(Identify missing PROJECT-SPECIFIC agents (NOT system agents) with industry validation)
NOTE(Gap analysis compares against PROJECT_AGENTS only, not SYSTEM_AGENTS FORBIDDEN: Suggesting system agents (AgentMaster, PromptMaster, etc.) as missing New agents use Master variation, NOT SystemMaster)

## Examples
 - First pass: Web-informed gap analysis for PROJECT agents
 - Task(mcp__brain__agent(web-research-master), 'INPUT(STORE-GET($PROJECT_AGENTS) && STORE-GET($PROJECT_STACK) && STORE-GET($INDUSTRY_PATTERNS) && STORE-GET($TECH_PATTERNS) && STORE-GET($CURRENT_YEAR) && STORE-GET($SEARCH_FILTER))', 'TASK → [Gather best practices for PROJECT agent coverage (exclude system agents) → Cross-reference with industry patterns from web search → Consider technology-specific agent requirements → EXCLUDE: system agent types (orchestration, delegation, memory management) → INCLUDE: domain-specific agents (API, Cache, Auth, Payment, etc.) → IF(search_mode === "targeted") → THEN → [Focus on $SEARCH_FILTER domains only] → END-IF] → END-TASK', 'OUTPUT({covered_domains: [...], missing_agents: [{name: \\'AgentName\\', purpose: \\'...\\', capabilities: [...], industry_alignment: 0-1}], confidence: 0-1})')
 - STORE-AS($WEB_GAP_ANALYSIS)
 - Second pass: Deep agent-level analysis with industry validation
 - Task(mcp__brain__agent(agent-master), 'INPUT(STORE-GET($PROJECT_AGENTS) && STORE-GET($SYSTEM_AGENTS) && STORE-GET($PROJECT_STACK) && STORE-GET($WEB_GAP_ANALYSIS) && STORE-GET($INDUSTRY_PATTERNS) && STORE-GET($TECH_PATTERNS) && STORE-GET($CURRENT_YEAR) && STORE-GET($SEARCH_FILTER))', 'TASK → [Analyze domain expertise needed based on Project requirements → Compare with existing PROJECT agents (NOT system agents) → EXCLUDE any agent that overlaps with SYSTEM_AGENTS functionality → Cross-validate against industry best practices → Validate each proposed agent against INDUSTRY_PATTERNS → Assign confidence score (0-1) to each missing agent recommendation → Prioritize critical gaps with high industry alignment → All new agents will use Master variation (NOT SystemMaster) → IF(search_mode === "targeted") → THEN → [Validate $SEARCH_FILTER.agents against project needs] → END-IF → FOREACH(missing domain) → [WebSearch({domain} agent architecture {current_year})] → END-FOREACH] → END-TASK', 'OUTPUT({covered_domains: [...], missing_agents: [{name: \\'AgentName\\', purpose: \\'...\\', capabilities: [...], confidence: 0-1, industry_alignment: 0-1, priority: "critical|high|medium", variation: "Master"}], industry_coverage_score: 0-1})', 'NOTE(Focus on PROJECT agent gaps with high confidence and industry alignment)')
 - STORE-AS($GAP_ANALYSIS)
 - Filter: confidence >= 0.6, industry_alignment >= 0.6, priority != "low"
 - Validate: NO agent names match SYSTEM_AGENTS list
 - Sort by: priority DESC, confidence DESC, industry_alignment DESC
</guideline>
<guideline id="phase5-parallel-generation">

GOAL(Create missing PROJECT agents via PARALLEL AgentMaster delegation. Max 5 concurrent AgentMasters.)
NOTE(Created agents are PROJECT agents using Master variation Created files must be valid PHP archetypes extending BrainCore\\Archetypes\\AgentArchetype FORBIDDEN: Creating any agent that matches SYSTEM_AGENTS list)

## Examples
 - Step 1: Filter and batch agents
 - Remove: existing agents, confidence < 0.6, priority === "low" Remove: any agent matching SYSTEM_AGENTS names (AgentMaster, PromptMaster, etc.) Keep: confidence >= 0.6 AND (priority === "critical" OR priority === "high") STORE-AS($FILTERED_AGENTS = '[...filtered project agents only...]')
 - Step 2: Batch into groups of 3 (max 5 batches = 15 agents)
 - batch_1 = agents[0:3], batch_2 = agents[3:6], ... STORE-AS($AGENT_BATCHES = '[[batch1], [batch2], [batch3], [batch4], [batch5]]')
 - Step 3: Pre-create all agent files via brain make:master
 - FOREACH(agent in $FILTERED_AGENTS) → [Bash(brain make:master {agent.name}) → [Creates .brain/node/Agents/{agent.name}.php] → END-Bash] → END-FOREACH
 - Step 4: PARALLEL delegation to 5 AgentMasters
 - CRITICAL: Launch ALL 5 Task() calls in SINGLE message block Each AgentMaster receives batch of 1-3 PROJECT agents to configure AgentMasters work CONCURRENTLY, not sequentially All agents use Master variation (for project agents)
 - FOREACH(batch in $AGENT_BATCHES (PARALLEL)) → [Task(mcp__brain__agent(agent-master), 'INPUT(batch_agents = [{name, purpose, capabilities, confidence, variation: "Master"}, ...] && STORE-GET($INDUSTRY_PATTERNS) && STORE-GET($TECH_PATTERNS) && STORE-GET($PROJECT_AGENTS))', 'TASK → [FOREACH agent in batch_agents: →   1. Read created file: .brain/node/Agents/{agent.name}.php →   2. Update #[Purpose()] with detailed domain expertise →   3. Add #[Includes(Master::class)] for project agent variation →   4. Add project-specific includes from .brain/node/Includes/ →   5. Define rules + guidelines in handle() →   6. Use PHP API only (Runtime::, Operator::, Store::) → Return: {completed: [...], failed: [...]}] → END-TASK', 'OUTPUT({batch_id, completed: [names], failed: [names], errors: [...]})')] → END-FOREACH
 - Step 5: Aggregate results from all AgentMasters
 - Merge: all completed PROJECT agents from 5 AgentMaster responses Collect: all failures for error report STORE-AS($GENERATION_SUMMARY = '{generated: [...], failed: [...], total: N, variation: "Master"}')
</guideline>
<guideline id="phase6-compile">
GOAL(Compile all agents to .gemini/agents/)
## Examples
 - Bash(brain compile) → [Compiles .brain/node/Agents/*.php to .gemini/agents/] → END-Bash
 - VERIFY-SUCCESS(CHECK(.gemini/agents/ for new agent files) Compilation completed without errors)
 - Log: "Compilation complete. New agents available in {AGENTS_FOLDER}"
</guideline>
<guideline id="phase7-report-enhanced">
GOAL(Report generation results with confidence scores, industry alignment, and caching status)
## Examples
 - IF(agents_generated > 0) → THEN → [Calculate: avg_confidence = average(generated_agents.confidence) → Calculate: avg_industry_alignment = average(generated_agents.industry_alignment) → mcp__vector-memory__store_memory('{content: "Init Gap Analysis: mode={search_mode}, technologies={$PROJECT_STACK.technologies}, agents_generated={agents_count}, avg_confidence={avg_confidence}, avg_industry_alignment={avg_industry_alignment}, coverage=improved, date={$CURRENT_DATE}", category: "architecture", tags: ["init", "gap-analysis", "agents", "{CURRENT_YEAR}"]}') → OUTPUT(Generation summary with agent details, confidence scores, and industry alignment metrics)] → END-IF
 - IF(agents_generated === 0) → THEN → [mcp__vector-memory__store_memory('{content: "Init Gap Analysis: mode={search_mode}, result=full_coverage, agents={agents_count}, date={$CURRENT_DATE}", category: "architecture", tags: ["init", "full-coverage", "{CURRENT_YEAR}"]}') → OUTPUT(Full coverage confirmation with existing agent list and industry coverage score)] → END-IF
 - Include cache performance metrics: {cache_hits}, {web_searches_performed}
</guideline>
<guideline id="response-format">
Response structure
## Examples
 - Header: Init Gap Analysis Complete | Mode: {search_mode}
 - Created: .brain/node/Agents/ | Compiled: .gemini/agents/
 - Ready via: Task(mcp__brain__agent({name}) '...')
 - Quality: confidence={avg}, alignment={avg}
 - Performance: cache_hits={n}, parallel_batches={n}
</guideline>
<guideline id="error-recovery">
Graceful degradation
## Examples
 - no .docs/ → Brain context only, continue
 - agent exists → skip, log preserved
 - system agent suggested → skip, log "system agent protected"
 - make:master fails → skip agent, continue
 - compile fails → report errors, list failed
 - AgentMaster fails → skip batch, continue
 - web timeout → use cached, mark partial
 - no internet → local only, -0.2 confidence
 - memory unavailable → skip cache, continue
</guideline>
<guideline id="quality-gates">
Validation checkpoints
## Examples
 - Gate 1-3: temporal context, cache check, list:masters
 - Gate 4: system vs project agents separated
 - Gate 5-6: web delegation, gap analysis output
 - Gate 7: NO system agents in GAP_ANALYSIS.missing_agents
 - Gate 8-9: confidence >= 0.6, alignment >= 0.6
 - Gate 10-11: make:master success, compile success
 - Gate 12: .gemini/agents/ populated with project agents
</guideline>
<guideline id="example-parallel-batch">
SCENARIO(System: 8 protected (SystemMaster) | Project: 10 discovered → 4 batches → 4 parallel AgentMasters)
## Examples
 - **inventory**: System agents (OFF LIMITS): AgentMaster, PromptMaster, CommitMaster, ExploreMaster, WebResearchMaster, DocumentationMaster, VectorMaster, ScriptMaster
 - **gap**: 10 missing PROJECT agents: API, Cache, Queue, Auth, Payment, Report, Search, Export, Import, Sync
 - **variation**: All new agents use Master variation (NOT SystemMaster)
 - **batch**: batch_1=[API,Cache,Queue], batch_2=[Auth,Payment,Report], batch_3=[Search,Export], batch_4=[Import,Sync]
 - **parallel**: Launch 4 Task(@agent-agent-master) in SINGLE message
 - **result**: All 10 PROJECT agents created with Master variation in ~1 AgentMaster cycle
</guideline>
<guideline id="directive">
PROJECT agents ONLY! Master variation! NEVER touch system agents! DELEGATE to AgentMaster! PARALLEL batches! brain make:master! Compile!
</guideline>
</guidelines>
</command>
"""